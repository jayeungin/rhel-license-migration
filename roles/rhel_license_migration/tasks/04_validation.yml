---
- name: Check Web Server Health
  block:
    - name: Verify Port 80
      wait_for:
        port: 80
        timeout: 10
    - name: Validate HTTP 200 Response
      uri:
        url: "http://localhost"
        status_code: 200
  when: "'httpd' in ansible_facts.packages or 'nginx' in ansible_facts.packages"

- name: Check Database Health
  block:
    - name: Verify DB Port (Postgres/MySQL)
      wait_for:
        port: "{{ item }}"
        timeout: 10
      loop: [5432, 3306]
      ignore_errors: true
  when: "'postgresql' in ansible_facts.packages or 'mysql-server' in ansible_facts.packages"
